'use strict';Object.defineProperty(exports,'__esModule',{value:true});var react=require('react'),react$1=require('@ai-sdk/react'),ai=require('ai'),jsxRuntime=require('react/jsx-runtime');var $e={name:"midnight",primary:"#6366f1",primaryHover:"#4f46e5",background:"#0f172a",surface:"#1e293b",surfaceHover:"#334155",text:"#f1f5f9",textSecondary:"#94a3b8",border:"#334155",userBubble:"#6366f1",userBubbleText:"#ffffff",assistantBubble:"#1e293b",assistantBubbleText:"#f1f5f9",error:"#ef4444",errorBg:"#450a0a"},Rt={name:"ocean",primary:"#0ea5e9",primaryHover:"#0284c7",background:"#0c1222",surface:"#172033",surfaceHover:"#1e3a5f",text:"#e0f2fe",textSecondary:"#7dd3fc",border:"#1e3a5f",userBubble:"#0ea5e9",userBubbleText:"#ffffff",assistantBubble:"#172033",assistantBubbleText:"#e0f2fe",error:"#f87171",errorBg:"#450a0a"},St={name:"forest",primary:"#22c55e",primaryHover:"#16a34a",background:"#052e16",surface:"#14532d",surfaceHover:"#166534",text:"#dcfce7",textSecondary:"#86efac",border:"#166534",userBubble:"#22c55e",userBubbleText:"#052e16",assistantBubble:"#14532d",assistantBubbleText:"#dcfce7",error:"#f87171",errorBg:"#450a0a"},vt={name:"sunset",primary:"#f97316",primaryHover:"#ea580c",background:"#1c1917",surface:"#292524",surfaceHover:"#44403c",text:"#fafaf9",textSecondary:"#d6d3d1",border:"#44403c",userBubble:"#f97316",userBubbleText:"#ffffff",assistantBubble:"#292524",assistantBubbleText:"#fafaf9",error:"#f87171",errorBg:"#450a0a"},Tt={name:"lavender",primary:"#a855f7",primaryHover:"#9333ea",background:"#1a0a2e",surface:"#2d1b4e",surfaceHover:"#3b2d5c",text:"#f3e8ff",textSecondary:"#d8b4fe",border:"#3b2d5c",userBubble:"#a855f7",userBubbleText:"#ffffff",assistantBubble:"#2d1b4e",assistantBubbleText:"#f3e8ff",error:"#f87171",errorBg:"#450a0a"},Q={midnight:$e,ocean:Rt,forest:St,sunset:vt,lavender:Tt},ee=$e;function Ct(e){return typeof e=="string"&&e in Q}function te(e){if(!e)return {...ee,name:ee.name};if(Ct(e)){let r=Q[e];return {...r,name:r.name}}let t=e;return {name:"custom",primary:t.primary,primaryHover:t.primaryHover??Te(t.primary,-15),background:t.background,surface:t.surface,surfaceHover:t.surfaceHover??Te(t.surface,10),text:t.text,textSecondary:t.textSecondary??Te(t.text,-30),border:t.border??t.surface,userBubble:t.userBubble??t.primary,userBubbleText:t.userBubbleText??"#ffffff",assistantBubble:t.assistantBubble??t.surface,assistantBubbleText:t.assistantBubbleText??t.text,error:t.error??"#ef4444",errorBg:t.errorBg??"#450a0a"}}function Te(e,t){let r=e.replace(/^#/,""),o=parseInt(r,16),n=(o>>16)+t,s=(o>>8&255)+t,a=(o&255)+t;return n=Math.max(0,Math.min(255,n)),s=Math.max(0,Math.min(255,s)),a=Math.max(0,Math.min(255,a)),`#${(n<<16|s<<8|a).toString(16).padStart(6,"0")}`}var _e={title:"Chat Assistant",placeholder:"Type your message...",send:"Send message",close:"Close chat",open:"Open chat",thinking:"Thinking",error:"Something went wrong. Please try again.",retry:"Retry",suggestionsTitle:"Suggested questions",restart:"Restart chat",rateLimitError:"Too many requests. Please wait a moment before trying again.",rateLimitRetryIn:"You can retry in",autoRetrying:"Retrying in",cancelAutoRetry:"Cancel"};var Fe={title:"Asistente de Chat",placeholder:"Escribe tu mensaje...",send:"Enviar mensaje",close:"Cerrar chat",open:"Abrir chat",thinking:"Pensando",error:"Algo sali\xF3 mal. Por favor, intenta de nuevo.",retry:"Reintentar",suggestionsTitle:"Preguntas sugeridas",restart:"Reiniciar chat",rateLimitError:"Demasiadas solicitudes. Por favor espera un momento.",rateLimitRetryIn:"Puedes reintentar en",autoRetrying:"Reintentando en",cancelAutoRetry:"Cancelar"};var re={en:_e,es:Fe};function It(e){return e in re}function Ye(e){return It(e)?re[e]:re.en}function Ce(e,t){let r=Ye(e);return t?{...r,...t}:r}function oe({size:e=24,style:t}){return jsxRuntime.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:t,children:jsxRuntime.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})})}function W({size:e=24,style:t}){return jsxRuntime.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:t,children:[jsxRuntime.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),jsxRuntime.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}function ne({size:e=18,style:t}){return jsxRuntime.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:t,children:[jsxRuntime.jsx("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),jsxRuntime.jsx("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})]})}function je({size:e=18,style:t}){return jsxRuntime.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:t,children:[jsxRuntime.jsx("path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}),jsxRuntime.jsx("path",{d:"M3 3v5h5"})]})}function se({theme:e,position:t,isOpen:r,onClick:o,openLabel:n,closeLabel:s,zIndex:a,openIcon:u,closeIcon:m}){let p={position:"fixed",bottom:"1rem",...t==="bottom-left"?{left:"1rem",right:"auto"}:{right:"1rem",left:"auto"},zIndex:a,display:"flex",height:"3.5rem",width:"3.5rem",alignItems:"center",justifyContent:"center",borderRadius:"50%",backgroundColor:e.primary,color:"#ffffff",border:"none",cursor:"pointer",boxShadow:`0 4px 20px ${e.primary}66`,transition:"all 0.2s"};return jsxRuntime.jsx("button",{onClick:o,"aria-label":r?s:n,"aria-expanded":r,style:p,onMouseEnter:d=>{d.currentTarget.style.transform="scale(1.05)",d.currentTarget.style.backgroundColor=e.primaryHover,d.currentTarget.style.boxShadow=`0 6px 24px ${e.primary}80`;},onMouseLeave:d=>{d.currentTarget.style.transform="scale(1)",d.currentTarget.style.backgroundColor=e.primary,d.currentTarget.style.boxShadow=`0 4px 20px ${e.primary}66`;},children:r?m??jsxRuntime.jsx(W,{}):u??jsxRuntime.jsx(oe,{})})}function kt(e){return typeof e=="object"&&e!==null&&"type"in e&&e.type==="text"&&"text"in e&&typeof e.text=="string"}function ie(e){return !e.parts||e.parts.length===0?"":e.parts.filter(kt).map(t=>t.text).join("")}function ae({suggestions:e,onSelect:t,theme:r,title:o}){let[n,s]=react.useState(null);if(!e?.length)return null;let a={marginTop:"0.75rem",display:"flex",flexDirection:"column",gap:"0.5rem"},u={fontSize:"0.75rem",color:r.textSecondary,marginBottom:"0.25rem"},m=l=>({padding:"0.5rem 0.75rem",fontSize:"0.875rem",backgroundColor:l?r.primary:r.surface,color:l?"#ffffff":r.text,border:`1px solid ${l?r.primary:r.border}`,borderRadius:"0.5rem",cursor:"pointer",textAlign:"left",transition:"all 0.2s",fontFamily:"inherit"});return jsxRuntime.jsxs("div",{style:a,children:[jsxRuntime.jsx("span",{style:u,children:o}),e.slice(0,3).map((l,p)=>jsxRuntime.jsx("button",{type:"button",style:m(n===p),onClick:()=>t(l),onMouseEnter:()=>s(p),onMouseLeave:()=>s(null),children:l},p))]})}var Ht=react.lazy(()=>import('react-markdown').catch(e=>(console.error("[ai-chat-widget] Failed to load react-markdown:",e),{default:({children:t})=>jsxRuntime.jsx("span",{children:t})}))),Ee=class extends react.Component{constructor(t){super(t),this.state={hasError:false};}static getDerivedStateFromError(){return {hasError:true}}render(){return this.state.hasError?jsxRuntime.jsx("span",{children:this.props.fallback}):this.props.children}};function le({message:e,theme:t,showSuggestions:r=true,isLastAssistantMessage:o=false,suggestionsTitle:n="Suggested questions",onSuggestionSelect:s}){let[a,u]=react.useState(null),m=ie(e),l=e.role==="user";if(react.useEffect(()=>{!l&&!a&&import('remark-gfm').then(c=>{u(()=>c.default);}).catch(c=>{console.error("[ai-chat-widget] Failed to load remark-gfm:",c);});},[l,a]),!m)return null;let p=!l&&r&&o&&s?e.parts?.find(c=>c.type==="data-suggestions")?.data??[]:[],d={maxWidth:"85%",borderRadius:"1rem",padding:"0.5rem 1rem",backgroundColor:l?t.userBubble:t.assistantBubble,color:l?t.userBubbleText:t.assistantBubbleText};return jsxRuntime.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:l?"flex-end":"flex-start"},children:[jsxRuntime.jsx("div",{style:d,children:l?jsxRuntime.jsx("p",{style:{fontSize:"0.875rem",margin:0},children:m}):jsxRuntime.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.5},className:"ai-chat-markdown",children:jsxRuntime.jsx(Ee,{fallback:m,children:jsxRuntime.jsx(react.Suspense,{fallback:jsxRuntime.jsx("span",{children:m}),children:jsxRuntime.jsx(Ht,{remarkPlugins:a?[a]:[],children:m})})})})}),p.length>0&&s&&jsxRuntime.jsx(ae,{suggestions:p,onSelect:s,theme:t,title:n})]})}function ce({theme:e,text:t}){let r={height:"0.5rem",width:"0.5rem",borderRadius:"50%",backgroundColor:e.primary};return jsxRuntime.jsx("div",{style:{display:"flex",justifyContent:"flex-start"},children:jsxRuntime.jsx("div",{style:{borderRadius:"1rem",backgroundColor:e.assistantBubble,padding:"0.5rem 1rem",color:e.assistantBubbleText},children:jsxRuntime.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[jsxRuntime.jsx("div",{style:{display:"flex",gap:"0.25rem"},children:[0,1,2].map(o=>jsxRuntime.jsx("span",{style:{...r,animation:"ai-chat-bounce 1s infinite",animationDelay:`${ -0.3+o*.15}s`}},o))}),jsxRuntime.jsxs("span",{style:{fontSize:"0.875rem",color:e.textSecondary},children:[t,"..."]})]})})})}function de({theme:e,errorText:t,rateLimitErrorText:r,retryText:o,autoRetryingText:n,cancelAutoRetryText:s,onRetry:a,errorInfo:u,countdown:m=0,isAutoRetrying:l=false,onCancelAutoRetry:p}){let d=u?.type==="rate_limit"?r:t,i=m>0,c=l?`${n} ${m}s...`:`${m}s`;return jsxRuntime.jsx("div",{style:{display:"flex",justifyContent:"flex-start"},children:jsxRuntime.jsxs("div",{style:{borderRadius:"1rem",backgroundColor:e.errorBg,padding:"0.5rem 1rem",color:e.error},children:[jsxRuntime.jsx("p",{style:{fontSize:"0.875rem",margin:0},children:d}),i&&jsxRuntime.jsx("p",{style:{fontSize:"0.75rem",margin:"0.25rem 0 0 0",opacity:.9},children:c}),jsxRuntime.jsxs("div",{style:{display:"flex",gap:"0.75rem",marginTop:"0.25rem"},children:[!(l&&i)&&jsxRuntime.jsx("button",{onClick:a,style:{fontSize:"0.875rem",fontWeight:500,color:e.error,textDecoration:"underline",background:"none",border:"none",cursor:"pointer",padding:0},children:o}),l&&i&&p&&jsxRuntime.jsx("button",{onClick:p,style:{fontSize:"0.875rem",fontWeight:500,color:e.error,textDecoration:"underline",background:"none",border:"none",cursor:"pointer",padding:0,opacity:.8},children:s})]})]})})}function fe({theme:e,value:t,onChange:r,onSubmit:o,placeholder:n,sendLabel:s,isLoading:a,autoFocus:u}){let m=react.useRef(null);react.useEffect(()=>{u&&m.current?.focus();},[u]);let l=i=>{i.preventDefault(),!(!t.trim()||a)&&o();},p={flex:1,borderRadius:"9999px",border:`1px solid ${e.border}`,backgroundColor:e.surface,padding:"0.5rem 1rem",fontSize:"0.875rem",color:e.text,outline:"none",transition:"all 0.2s",opacity:a?.5:1},d={display:"flex",height:"2.5rem",width:"2.5rem",alignItems:"center",justifyContent:"center",borderRadius:"50%",backgroundColor:e.primary,color:"#ffffff",border:"none",cursor:a||!t.trim()?"not-allowed":"pointer",opacity:a||!t.trim()?.5:1,transition:"all 0.2s"};return jsxRuntime.jsx("form",{onSubmit:l,style:{borderTop:`1px solid ${e.border}`,backgroundColor:e.surface,padding:"1rem"},children:jsxRuntime.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[jsxRuntime.jsx("input",{ref:m,type:"text",value:t,onChange:i=>r(i.target.value),placeholder:n,disabled:a,style:p,onFocus:i=>{i.currentTarget.style.borderColor=e.primary,i.currentTarget.style.boxShadow=`0 0 0 2px ${e.primary}33`;},onBlur:i=>{i.currentTarget.style.borderColor=e.border,i.currentTarget.style.boxShadow="none";}}),jsxRuntime.jsx("button",{type:"submit",disabled:a||!t.trim(),"aria-label":s,style:d,onMouseEnter:i=>{!a&&t.trim()&&(i.currentTarget.style.backgroundColor=e.primaryHover);},onMouseLeave:i=>{i.currentTarget.style.backgroundColor=e.primary;},children:jsxRuntime.jsx(ne,{})})]})})}function Ge(e,t){let r=react.useRef(null),o=react.useRef(e),n=react.useCallback(()=>{r.current?.scrollIntoView({behavior:"smooth"});},[]);return react.useEffect(()=>{let s=e>o.current;o.current=e,(s||t)&&n();},[e,t,n]),{ref:r,scrollToBottom:n}}var _t={position:"absolute",width:16,height:16,zIndex:10,background:"transparent"},Ft=[{corner:"nw",style:{top:0,left:0},cursor:"nwse-resize"},{corner:"ne",style:{top:0,right:0},cursor:"nesw-resize"},{corner:"sw",style:{bottom:0,left:0},cursor:"nesw-resize"},{corner:"se",style:{bottom:0,right:0},cursor:"nwse-resize"}];function Le({onResizeStart:e,isResizing:t}){return jsxRuntime.jsx(jsxRuntime.Fragment,{children:Ft.map(({corner:r,style:o,cursor:n})=>jsxRuntime.jsx("div",{"aria-hidden":"true",style:{..._t,...o,cursor:n},onMouseDown:s=>e(r,s)},r))})}function me({theme:e,position:t,messages:r,input:o,onInputChange:n,onSubmit:s,onRetry:a,onClose:u,onRestart:m,onSuggestionSelect:l,isLoading:p,error:d,labels:i,title:c,headerIcon:h,placeholder:f,width:y,height:I,zIndex:E,showSuggestions:R,isClosing:x=false,resizable:S,isMobile:w,isResizing:b,onResizeStart:k,errorInfo:v,countdown:C,isAutoRetrying:O,onCancelAutoRetry:z}){let{ref:M}=Ge(r.length,p),A=r.reduceRight((g,_,we)=>g===-1&&_.role==="assistant"?we:g,-1),$={position:"fixed",bottom:"6rem",...t==="bottom-left"?{left:"1rem",right:"auto"}:{right:"1rem",left:"auto"},zIndex:E,display:"flex",height:w?"calc(100vh - 7rem)":`${I}px`,width:w?"calc(100vw - 1rem)":`${y}px`,maxWidth:"calc(100vw - 2rem)",flexDirection:"column",overflow:"hidden",borderRadius:"1rem",border:`1px solid ${e.border}`,backgroundColor:e.background,boxShadow:`0 8px 32px ${e.primary}40`,transition:b?"none":"width 0.1s ease-out, height 0.1s ease-out"},G={display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:`1px solid ${e.border}`,background:`linear-gradient(to right, ${e.primary}, ${e.primaryHover})`,padding:"0.75rem 1rem"},xe=x?"ai-chat-window-closing":"ai-chat-window-opening";return jsxRuntime.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":c?"ai-chat-title":void 0,"aria-label":c?void 0:i.title,className:xe,style:$,children:[jsxRuntime.jsxs("div",{style:G,children:[jsxRuntime.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flex:1,minWidth:0},children:[h&&jsxRuntime.jsx("span",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",flexShrink:0},children:typeof h=="string"?jsxRuntime.jsx("span",{style:{fontSize:"1.25rem",lineHeight:1},children:h}):jsxRuntime.jsx("span",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%"},children:h})}),c&&jsxRuntime.jsx("h2",{id:"ai-chat-title",style:{fontSize:"1.125rem",fontWeight:600,color:"#ffffff",margin:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:c})]}),jsxRuntime.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[jsxRuntime.jsx("button",{onClick:m,"aria-label":i.restart,style:{borderRadius:"50%",padding:"0.25rem",color:"rgba(255, 255, 255, 0.8)",background:"transparent",border:"none",cursor:"pointer",transition:"all 0.2s",flexShrink:0},onMouseEnter:g=>{g.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.2)",g.currentTarget.style.color="white";},onMouseLeave:g=>{g.currentTarget.style.backgroundColor="transparent",g.currentTarget.style.color="rgba(255, 255, 255, 0.8)";},children:jsxRuntime.jsx(je,{size:18})}),jsxRuntime.jsx("button",{onClick:u,"aria-label":i.close,style:{borderRadius:"50%",padding:"0.25rem",color:"rgba(255, 255, 255, 0.8)",background:"transparent",border:"none",cursor:"pointer",transition:"all 0.2s",flexShrink:0},onMouseEnter:g=>{g.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.2)",g.currentTarget.style.color="white";},onMouseLeave:g=>{g.currentTarget.style.backgroundColor="transparent",g.currentTarget.style.color="rgba(255, 255, 255, 0.8)";},children:jsxRuntime.jsx(W,{size:20})})]})]}),jsxRuntime.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem",backgroundColor:e.background},children:jsxRuntime.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[r.map((g,_)=>jsxRuntime.jsx(le,{message:g,theme:e,showSuggestions:R,isLastAssistantMessage:_===A&&!p,suggestionsTitle:i.suggestionsTitle,onSuggestionSelect:l},g.id)),p&&jsxRuntime.jsx(ce,{theme:e,text:i.thinking}),d&&jsxRuntime.jsx(de,{theme:e,errorText:i.error,rateLimitErrorText:i.rateLimitError,retryText:i.retry,autoRetryingText:i.autoRetrying,cancelAutoRetryText:i.cancelAutoRetry,onRetry:a,errorInfo:v,countdown:C,isAutoRetrying:O,onCancelAutoRetry:z}),jsxRuntime.jsx("div",{ref:M})]})}),jsxRuntime.jsx(fe,{theme:e,value:o,onChange:n,onSubmit:s,placeholder:f,sendLabel:i.send,isLoading:p,autoFocus:true}),S&&!w&&jsxRuntime.jsx(Le,{onResizeStart:k,isResizing:b})]})}var tt="ai-chat-widget-size";function ge(e,t,r){return Math.min(Math.max(e,t),r)}function Qe(){if(typeof window>"u")return null;try{let e=localStorage.getItem(tt);if(!e)return null;let t=JSON.parse(e);if(typeof t.width=="number"&&typeof t.height=="number")return t}catch{}return null}function et(e){if(!(typeof window>"u"))try{localStorage.setItem(tt,JSON.stringify(e));}catch{}}function rt({initialWidth:e,initialHeight:t,minWidth:r,maxWidth:o,minHeight:n,maxHeight:s,enabled:a}){let[u,m]=react.useState(()=>{if(!a)return e;let f=Qe();return f?ge(f.width,r,o):e}),[l,p]=react.useState(()=>{if(!a)return t;let f=Qe();return f?ge(f.height,n,s):t}),[d,i]=react.useState(false),c=react.useRef(null),h=react.useCallback((f,y)=>{a&&(y.preventDefault(),y.stopPropagation(),c.current={corner:f,startX:y.clientX,startY:y.clientY,startWidth:u,startHeight:l},i(true),document.body.style.userSelect="none",document.body.style.cursor=f==="nw"||f==="se"?"nwse-resize":"nesw-resize");},[a,u,l]);return react.useEffect(()=>{if(!d)return;let f=I=>{if(!c.current)return;let{corner:E,startX:R,startY:x,startWidth:S,startHeight:w}=c.current,b=I.clientX-R,k=I.clientY-x,v=S,C=w;switch(E){case "se":v=S+b,C=w+k;break;case "sw":v=S-b,C=w+k;break;case "ne":v=S+b,C=w-k;break;case "nw":v=S-b,C=w-k;break}v=ge(v,r,o),C=ge(C,n,s),m(v),p(C);},y=()=>{c.current&&et({width:u,height:l}),c.current=null,i(false),document.body.style.userSelect="",document.body.style.cursor="";};return document.addEventListener("mousemove",f),document.addEventListener("mouseup",y),()=>{document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",y);}},[d,u,l,r,o,n,s]),react.useEffect(()=>{!d&&a&&et({width:u,height:l});},[u,l,d,a]),{width:u,height:l,isResizing:d,handleResizeStart:h}}var ot=640;function nt(){let[e,t]=react.useState(()=>typeof window>"u"?false:window.innerWidth<ot);return react.useEffect(()=>{let r=window.matchMedia(`(max-width: ${ot-1}px)`),o=n=>{t(n.matches);};return t(r.matches),r.addEventListener("change",o),()=>{r.removeEventListener("change",o);}},[]),e}var Vt=[/rate.?limit/i,/too.?many.?requests/i,/quota.?exceeded/i,/throttl/i,/try.?again.?later/i,/request.?limit/i,/api.?limit/i];function st(e){let t=e;if(typeof t.status=="number")return t.status;if(typeof t.statusCode=="number")return t.statusCode;if(typeof t.code=="number")return t.code;if(t.response&&typeof t.response=="object"){let o=t.response;if(typeof o.status=="number")return o.status;if(typeof o.statusCode=="number")return o.statusCode}let r=e.message.match(/status[:\s]+(\d{3})/i);if(r)return parseInt(r[1],10)}function Gt(e){let t=e;if(typeof t.retryAfter=="number")return t.retryAfter;if(typeof t.retryAfterSeconds=="number")return t.retryAfterSeconds;if(t.headers&&typeof t.headers=="object"){let o=t.headers,n=o["retry-after"]||o["Retry-After"];if(typeof n=="string"){let s=parseInt(n,10);if(!isNaN(s))return s}if(typeof n=="number")return n}if(t.response&&typeof t.response=="object"){let o=t.response;if(o.headers&&typeof o.headers=="object"){let n=o.headers,s=n["retry-after"]||n["Retry-After"];if(typeof s=="string"){let a=parseInt(s,10);if(!isNaN(a))return a}if(typeof s=="number")return s}}let r=e.message.match(/(?:in|after)\s+(\d+)\s*(?:second|sec|s\b)/i);if(r)return parseInt(r[1],10)}function it(e){return Vt.some(t=>t.test(e))}function Zt(e,t){let r=e.message.toLowerCase();return t===429?"rate_limit":t===401||t===403?"auth":t&&t>=500?"server":it(e.message)?"rate_limit":r.includes("network")||r.includes("fetch")||r.includes("connection")||r.includes("timeout")||r.includes("offline")?"network":r.includes("unauthorized")||r.includes("forbidden")||r.includes("auth")?"auth":r.includes("server")||r.includes("internal")?"server":"generic"}function Jt(e){return e==="rate_limit"||e==="network"||e==="server"}function ye(e){if(!e)return null;let t=st(e),r=Zt(e,t),o=r==="rate_limit"?Gt(e):void 0;return {type:r,originalError:e,statusCode:t,retryAfterSeconds:o,isRetriable:Jt(r)}}function at(e){return e?st(e)===429?true:it(e.message):false}var he={autoRetry:false,maxRetries:3,baseDelayMs:1e3,maxDelayMs:3e4};function Qt(e,t,r,o){if(o&&o>0)return Math.min(o*1e3,r);let n=t*Math.pow(2,e-1),s=n*.25*Math.random();return Math.min(n+s,r)}function ze({errorInfo:e,onRetry:t,autoRetry:r=he.autoRetry,maxRetries:o=he.maxRetries,baseDelayMs:n=he.baseDelayMs,maxDelayMs:s=he.maxDelayMs}){let[a,u]=react.useState(0),[m,l]=react.useState(false),[p,d]=react.useState(0),i=react.useRef(null),c=react.useRef(null),h=react.useRef(null),f=react.useCallback(()=>{c.current&&(clearInterval(c.current),c.current=null),h.current&&(clearTimeout(h.current),h.current=null);},[]),y=react.useCallback(()=>{f(),l(false),u(0);},[f]),I=react.useCallback(()=>{f(),l(false),u(0),d(0),t();},[f,t]),E=react.useCallback((R,x)=>{f();let S=Math.ceil(R/1e3);u(S),l(r&&x<=o),c.current=setInterval(()=>{u(w=>w<=1?(c.current&&(clearInterval(c.current),c.current=null),0):w-1);},1e3),r&&x<=o&&(h.current=setTimeout(()=>{l(false),u(0),t();},R));},[r,o,f,t]);return react.useEffect(()=>{let R=e?.originalError??null;if(!e||e.type!=="rate_limit"){i.current!==null&&(y(),d(0)),i.current=R;return}if(R!==i.current){i.current=R;let x=p+1;d(x);let S=Qt(x,n,s,e.retryAfterSeconds);E(S,x);}return ()=>{}},[e,p,n,s,E,y]),react.useEffect(()=>()=>{f();},[f]),{countdown:a,isAutoRetrying:m,retryAttempt:p,cancelAutoRetry:y,manualRetry:I}}var We=class extends react.Component{constructor(t){super(t),this.state={hasError:false,error:null};}static getDerivedStateFromError(t){return {hasError:true,error:t}}componentDidCatch(t,r){console.error("[ai-chat-widget] Error caught by boundary:",t,r);}render(){return this.state.hasError?this.props.fallback?this.props.fallback:null:this.props.children}},or="'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif",ct="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap",He=200;function nr({apiUrl:e,theme:t,position:r,labels:o,title:n,placeholder:s,greeting:a,defaultOpen:u,width:m,height:l,minWidth:p,maxWidth:d,minHeight:i,maxHeight:c,resizable:h,zIndex:f,lang:y,icon:I,headerIcon:E,fontFamily:R,loadDefaultFont:x,showSuggestions:S,rateLimitOptions:w}){let[b,k]=react.useState(u),[v,C]=react.useState(u),[O,z]=react.useState(false),[M,A]=react.useState(""),[U,K]=react.useState(()=>crypto.randomUUID()),[V,$]=react.useState(!x),G=nt(),{width:xe,height:g,isResizing:_,handleResizeStart:we}=rt({initialWidth:m,initialHeight:l,minWidth:p,maxWidth:d,minHeight:i,maxHeight:c,enabled:h&&!G});react.useEffect(()=>{if(b)C(true),z(false);else if(v){z(true);let P=setTimeout(()=>{C(false),z(false);},He);return ()=>clearTimeout(P)}},[b,v]),react.useEffect(()=>{if(!x)return;if(document.querySelector(`link[href="${ct}"]`)){$(true);return}let H=document.createElement("link");H.rel="stylesheet",H.href=ct,H.onload=()=>$(true),H.onerror=()=>{console.warn("[ai-chat-widget] Failed to load Inter font, using system fonts"),$(true);},document.head.appendChild(H);},[x]);let pt=react.useMemo(()=>new ai.DefaultChatTransport({api:e,body:{lang:y,sessionId:U}}),[e,y,U]),Re=a?[{id:"greeting",role:"assistant",parts:[{type:"text",text:a}]}]:[],{messages:ft,sendMessage:Z,regenerate:Se,setMessages:Ne,status:De,error:ve}=react$1.useChat({transport:pt,messages:Re}),F=De==="streaming"||De==="submitted",J=react.useMemo(()=>ye(ve),[ve]),{countdown:mt,isAutoRetrying:gt,cancelAutoRetry:yt,manualRetry:Oe}=ze({errorInfo:J,onRetry:()=>Se(),...w}),bt=react.useCallback(()=>{Ne(Re),A(""),K(crypto.randomUUID());},[Ne,Re]);react.useEffect(()=>{let P=H=>{H.key==="Escape"&&b&&k(false);};return document.addEventListener("keydown",P),()=>document.removeEventListener("keydown",P)},[b]);let Ue=react.useCallback(()=>k(P=>!P),[]),ht=react.useCallback(()=>{!M.trim()||F||(Z({text:M}),A(""));},[M,F,Z]),xt=react.useCallback(()=>{J?.type==="rate_limit"?Oe():Se();},[J,Oe,Se]),wt=react.useCallback(P=>{F||Z({text:P});},[F,Z]);return jsxRuntime.jsxs("div",{className:"ai-chat-widget-root",style:{fontFamily:R},children:[v&&V&&jsxRuntime.jsx(me,{theme:t,position:r,messages:ft,input:M,onInputChange:A,onSubmit:ht,onRetry:xt,onClose:Ue,onRestart:bt,onSuggestionSelect:wt,isLoading:F,error:ve,labels:o,title:n,headerIcon:E,placeholder:s,width:xe,height:g,zIndex:f,showSuggestions:S,isClosing:O,resizable:h,isMobile:G,isResizing:_,onResizeStart:we,errorInfo:J,countdown:mt,isAutoRetrying:gt,onCancelAutoRetry:yt}),jsxRuntime.jsx(se,{theme:t,position:r,isOpen:b,onClick:Ue,openLabel:o.open,closeLabel:o.close,zIndex:f,openIcon:I?.open,closeIcon:I?.close}),jsxRuntime.jsx("style",{children:`
        @keyframes ai-chat-bounce {
          0%, 80%, 100% { transform: translateY(0); }
          40% { transform: translateY(-6px); }
        }
        @keyframes ai-chat-window-open {
          from {
            opacity: 0;
            transform: scale(0.95) translateY(10px);
          }
          to {
            opacity: 1;
            transform: scale(1) translateY(0);
          }
        }
        @keyframes ai-chat-window-close {
          from {
            opacity: 1;
            transform: scale(1) translateY(0);
          }
          to {
            opacity: 0;
            transform: scale(0.95) translateY(10px);
          }
        }
        .ai-chat-window-opening {
          animation: ai-chat-window-open ${He}ms cubic-bezier(0.16, 1, 0.3, 1) forwards;
          will-change: transform, opacity;
        }
        .ai-chat-window-closing {
          animation: ai-chat-window-close ${He}ms cubic-bezier(0.16, 1, 0.3, 1) forwards;
          will-change: transform, opacity;
        }
        .ai-chat-markdown p { margin: 0.25rem 0; }
        .ai-chat-markdown ul, .ai-chat-markdown ol { margin: 0.25rem 0; padding-left: 1.25rem; }
        .ai-chat-markdown li { margin: 0; }
        .ai-chat-markdown strong { font-weight: 600; }
        .ai-chat-markdown a { color: ${t.primary}; text-decoration: underline; }
        .ai-chat-markdown code {
          background: ${t.surfaceHover};
          padding: 0.125rem 0.25rem;
          border-radius: 0.25rem;
          font-size: 0.875em;
        }
        .ai-chat-markdown pre {
          background: ${t.surfaceHover};
          padding: 0.75rem;
          border-radius: 0.5rem;
          overflow-x: auto;
          margin: 0.5rem 0;
        }
        .ai-chat-markdown pre code {
          background: transparent;
          padding: 0;
        }
      `})]})}function D(e,t){return e.endsWith("px")?parseInt(e,10)||t:e.endsWith("vh")?parseInt(e,10)/100*(typeof window<"u"?window.innerHeight:800)||t:e.endsWith("vw")?parseInt(e,10)/100*(typeof window<"u"?window.innerWidth:1200)||t:parseInt(e,10)||t}function dt({apiUrl:e,theme:t,position:r="bottom-right",lang:o="en",labels:n,greeting:s,defaultOpen:a=false,title:u,placeholder:m,width:l="420px",height:p="600px",minWidth:d="300px",maxWidth:i="600px",minHeight:c="400px",maxHeight:h="80vh",resizable:f=true,zIndex:y=50,icon:I,headerIcon:E,fontFamily:R,showSuggestions:x=true,rateLimitOptions:S={}}){let w=te(t),b=Ce(o,n),k=u===""||u===false?void 0:u??b.title,v=m??b.placeholder,C=R??or,O=!R,z=D(l,380),M=D(p,500),A=D(d,300),U=D(i,600),K=D(c,400),V=D(h,typeof window<"u"?window.innerHeight*.8:600);return jsxRuntime.jsx(We,{children:jsxRuntime.jsx(nr,{apiUrl:e,theme:w,position:r,labels:b,title:k,placeholder:v,greeting:s,defaultOpen:a,width:z,height:M,minWidth:A,maxWidth:U,minHeight:K,maxHeight:V,resizable:f,zIndex:y,lang:o,icon:I,headerIcon:E,fontFamily:C,loadDefaultFont:O,showSuggestions:x,rateLimitOptions:S})})}var sr=dt;exports.ChatButton=se;exports.ChatIcon=oe;exports.ChatWidget=dt;exports.ChatWindow=me;exports.CloseIcon=W;exports.ErrorMessage=de;exports.LoadingIndicator=ce;exports.MessageBubble=le;exports.MessageInput=fe;exports.SendIcon=ne;exports.SuggestionBox=ae;exports.classifyError=ye;exports.default=sr;exports.defaultTheme=ee;exports.getLabels=Ye;exports.getMessageText=ie;exports.isRateLimitError=at;exports.mergeLabels=Ce;exports.presets=Q;exports.resolveTheme=te;exports.translations=re;exports.useRateLimitRetry=ze;//# sourceMappingURL=index.cjs.map
//# sourceMappingURL=index.cjs.map